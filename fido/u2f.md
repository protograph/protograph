# U2F Registration and Authentication Protocol

## Notes
$`ID`$ is actually a key handle and
generated by a cryptographic function.

## Actors
U: U2F Device
C: Browser (Client)
S: Web Server (Relying Party)

## Flows

### C sends S (color=blue)
Start U2F Registration
      
### C and S exchange messages about
First factor authentication (username and password)

### S computes
challenge $<-$ RANDOM

### S sends C
challenge

### Then C computes
o = origin
c = hash(challenge + TLS channel ID)

### C sends U
o, c

### U computes 
$`SK`_`o`, `PK`_`o`, `ID`_`o` <- $ GenKey(o)
s = sign($`c`, `PK`_`o`, `ID`_`o`$)

### U sends C
$`PK`_`o`, `ID`_`o`$, s, attestation cert

### C sends S
challenge, TLS channel id,
$`PK`_`o`, `ID`_`o`$, s,
attestation cert

### C sends S (padtop=1, color=blue)
Start U2F Authentication
      
### C and S exchange messages about
First factor authentication (username and password)

### S computes
challenge $<-$ RANDOM

### S sends C
$`ID`_`o`$, challenge

### Then C computes
o = origin
c = hash(challenge + TLS channel ID)

### C sends U
o,  $`ID`_`o`$, c

### U computes 
increment counter
s = sign(c, counter)

### U sends C
counter, s

### C sends S
counter, s, challenge, TLS channel ID

### S sends C
set-cookie
